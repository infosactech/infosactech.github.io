---
title: V2.8.4 One Time Verifier
---



## Requirement:

Verify that time-based OTP can be used only once within the validity period.

## Explanation:

Одноразовый пароль на основе времени (TOTP) — это безопасный механизм аутентификации, который генерирует уникальный код для каждой попытки входа в систему. Код генерируется на основе текущего времени и секретного ключа, совместно используемого пользователем и сервером. Причина, по которой TOTP можно использовать только один раз в течение срока действия, заключается в том, что код чувствителен ко времени. Сервер принимает TOTP только в течение определенного периода времени, обычно 30 или 60 секунд. По истечении этого времени код становится недействительным и не может быть использован повторно. Эта чувствительность ко времени делает практически невозможным повторное использование TOTP для злоумышленника, даже если он каким-то образом получил его. Кроме того, TOTP уникален для каждой попытки входа в систему, поэтому, даже если злоумышленник сможет использовать TOTP в течение срока действия, ему все равно придется получать новый TOTP для каждой последующей попытки входа. Это делает TOTP эффективным способом защиты входа в систему и предотвращения несанкционированного доступа.

## Remediation:



Чтобы гарантировать, что TOTP можно использовать только один раз в течение срока их действия, обычно предпринимаются следующие шаги: 

- Генерация секретного ключа. Первым шагом в процессе TOTP является генерация секретного ключа, который будет использоваться совместно пользователем и сервером. Этот секретный ключ используется для генерации кода TOTP для каждой попытки входа в систему. 
- Чувствительность ко времени: TOTP генерируются на основе текущего времени и секретного ключа. Это означает, что код будет разным для каждой попытки входа в систему, даже если секретный ключ останется прежним. Код действителен только в течение определенного периода времени, обычно 30 или 60 секунд, после чего он становится недействительным. 
- Период действия: период действия — это период времени, в течение которого код TOTP считается действительным. По истечении срока действия код нельзя использовать повторно. Это делает практически невозможным повторное использование TOTP для злоумышленника, даже если он каким-то образом получил его. 
- Генерация уникального кода: TOTP уникальны для каждой попытки входа в систему, поэтому, даже если злоумышленник сможет использовать TOTP в течение срока действия, ему все равно придется получать новый TOTP для каждой последующей попытки входа. Это делает TOTP эффективным способом защиты входа в систему и предотвращения несанкционированного доступа. 


В заключение, TOTP можно использовать только один раз в течение срока их действия, поскольку они генерируются на основе текущего времени и секретного ключа и становятся недействительными по истечении определенного периода времени. Эта чувствительность ко времени в сочетании с уникальным процессом генерации кода делает TOTP эффективным и безопасным механизмом аутентификации.

Вот пример реализации кода одноразового пароля на основе времени (TOTP) в Python:


```python
import pyotp
import time

# Generate a secret key
secret_key = pyotp.random_base32()

# Generate a TOTP object using the secret key
totp = pyotp.TOTP(secret_key)

# Get the current TOTP code
current_code = totp.now()

# Verify the TOTP code entered by the user
def verify_code(user_code):
    # Check if the user code is valid within the time-based validity period (typically 30 or 60 seconds)
    if totp.verify(user_code):
        print("TOTP code is valid")
    else:
        print("TOTP code is invalid")

# Example usage
user_code = input("Enter TOTP code: ")
verify_code(user_code)


```


В этом примере библиотека pyotp используется для генерации и проверки кода TOTP. secret_key генерируется с помощью метода random_base32(), который генерирует случайный секретный ключ в кодировке base32. Объект TOTP создается с использованием секретного ключа, а текущий код TOTP генерируется с использованием метода now(). Функция verify_code используется для проверки кода TOTP, введенного пользователем, а метод verify () используется для проверки того, действителен ли код в течение периода действия, основанного на времени.




## Additional:




